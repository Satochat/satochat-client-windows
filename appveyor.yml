image: Visual Studio 2017

notifications:
  - provider: Email
    on_build_success: false
    on_build_failure: false
    on_build_status_changed: false

install:
  - ps: Invoke-WebRequest -UseBasicParsing -OutFile InstallDocker.msi https://download.docker.com/win/edge/InstallDocker.msi
  - cmd: msiexec /i InstallDocker.msi /quiet /qn /norestart /log InstallDocker.log; Get-Content InstallDocker.log
  - cmd: path C:\Program Files\Docker\Docker;C:\Program Files\Docker\Docker\resources\bin;%PATH%
  - cmd: docker version
  - cmd: docker-compose version
  - cmd: DockerCli -Version
  - cmd: DockerCli -SwitchDaemon
  - ps: .\scripts\ci\StrongNameKey.ps1
  - ps: .\scripts\ci\CodeSigningCertificate.ps1
  - ps: nuget restore -Source $env:NUGET_SOURCE_URL

build_script:
  - ps: .\scripts\ci\Build.ps1

deploy_script:
  - ps: if (-not $env:APPVEYOR_PULL_REQUEST_NUMBER -and $env:APPVEYOR_REPO_BRANCH -eq "releases") { .\scripts\ci\DeployDocker.ps1 }
